<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>User Dashboard - X-Cargo Express</title>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    display: flex;
    height: 100vh;
    background: #f9f9f9;
  }

  /* Sidebar */
  .sidebar {
    width: 220px;
    background: #111;
    color: #fff;
    display: flex;
    flex-direction: column;
    padding-top: 20px;
    position: fixed;
    height: 100%;
  }

  .sidebar h2 {
    text-align: center;
    margin-bottom: 20px;
    font-size: 18px;
  }

  .sidebar a {
    padding: 12px 20px;
    text-decoration: none;
    color: #fff;
    font-size: 16px;
    transition: 0.2s;
    cursor: pointer;
  }

  .sidebar a:hover, .sidebar a.active {
    background: #ffcc00;
    color: #111;
    font-weight: bold;
  }

  /* Main content */
  .content {
    margin-left: 220px;
    flex: 1;
    padding: 20px;
    overflow-y: auto;
  }

  .page {
    display: none;
  }

  .page.active {
    display: block;
  }

  /* Emergency message */
  .emergency {
    background: #ff4444;
    color: #fff;
    padding: 15px;
    border-radius: 6px;
    margin-bottom: 20px;
  }

  .emergency img {
    max-width: 100%;
    margin-top: 10px;
    border-radius: 4px;
  }
</style>
</head>
<body>

<div class="sidebar">
  <h2>User Dashboard</h2>
  <a data-page="home" class="active">🏠 Home</a>
  <a data-page="profile">👤 My Profile</a>
  <a data-page="create">📦 Create Package</a>
  <a data-page="formbuilder">📝 Form Builder</a>
  <a data-page="formtemplates">📑 Form Templates</a>
  <a data-page="mypackages">📄 My Packages</a>
  <a href="index.html">🚪 Logout</a>
</div>

<div class="content">
  <!-- Home Page -->
  <div id="home" class="page active">
    <h2>Welcome to X-Cargo Express</h2>
    <div id="emergencyContainer">
      <!-- Admin emergency messages will appear here -->
    </div>
  </div>

  <!-- Profile Page -->
  <div id="profile" class="page">
    <h2>My Profile</h2>
    <p>Profile information will appear here.</p>
  </div>

  <!-- Create Package Page -->
  <div id="create" class="page">
    <iframe src="create-package.html" width="100%" height="1000px" style="border:none;"></iframe>
  </div>

  <!-- Form Builder Page -->
  <div id="formbuilder" class="page">
    <iframe src="form-builder.html" width="100%" height="1000px" style="border:none;"></iframe>
  </div>

  <!-- Form Templates Page -->
  <div id="formtemplates" class="page">
    <iframe src="form-templates.html" width="100%" height="1000px" style="border:none;"></iframe>
  </div>

  <!-- My Packages Page -->
  <div id="mypackages" class="page">
    <iframe src="mypackages.html" width="100%" height="1000px" style="border:none;"></iframe>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-auth.js";
  import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBLYDpP68NlfYGE1O9DafgrmFBUlgpoYeI",
    authDomain: "x-cargo-exprees.firebaseapp.com",
    databaseURL: "https://x-cargo-exprees-default-rtdb.firebaseio.com",
    projectId: "x-cargo-exprees",
    storageBucket: "x-cargo-exprees.appspot.com",
    messagingSenderId: "1082201867958",
    appId: "1:1082201867958:web:d6600fbc82085b0b62c817",
    measurementId: "G-C3Y4PQC86V"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getDatabase(app);

  // Auth check
  onAuthStateChanged(auth, (user) => {
    if (!user) {
      window.location.href = 'index.html';
    }
  });

  // Sidebar navigation
  const links = document.querySelectorAll('.sidebar a[data-page]');
  const pages = document.querySelectorAll('.page');

  links.forEach(link => {
    link.addEventListener('click', () => {
      // Remove active class from all links
      links.forEach(l => l.classList.remove('active'));
      link.classList.add('active');

      // Show the selected page
      const target = link.getAttribute('data-page');
      pages.forEach(p => p.classList.remove('active'));
      document.getElementById(target).classList.add('active');
    });
  });

  // Emergency messages from Firebase
  const emergencyContainer = document.getElementById('emergencyContainer');
  const emergencyRef = ref(db, 'emergencyMessages');

  onValue(emergencyRef, (snapshot) => {
    emergencyContainer.innerHTML = '';
    snapshot.forEach(child => {
      const msg = child.val();
      const div = document.createElement('div');
      div.classList.add('emergency');
      div.innerHTML = `<strong>${msg.title}</strong><p>${msg.text}</p>`;
      if(msg.image) {
        const img = document.createElement('img');
        img.src = msg.image;
        div.appendChild(img);
      }
      emergencyContainer.appendChild(div);
    });
  });
</script>

</body>
</html>
