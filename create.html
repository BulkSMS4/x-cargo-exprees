<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Create Package - X-Cargo Express</title>
<style>
  body {
    font-family: Arial, sans-serif;
    padding: 20px;
    max-width: 800px;
    margin: auto;
    background: #fff;
    color: #333;
  }
  label {
    font-weight: bold;
  }
  input, textarea, select, button {
    display: block;
    width: 100%;
    padding: 10px;
    margin: 6px 0 16px;
    border: 1px solid #ccc;
    border-radius: 5px;
  }
  .checkbox-group {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 16px;
  }
  h3 {
    margin-top: 40px;
    border-bottom: 1px solid #ccc;
    padding-bottom: 4px;
  }
  #preview {
    margin-top: 30px;
    border: 1px solid #ccc;
    padding: 15px;
    border-radius: 10px;
    background: #f9f9f9;
    min-height: 50px;
  }
  #preview img {
    max-width: 100%;
    height: auto;
    margin-top: 10px;
  }
  .suspended {
    font-weight: bold;
    padding: 5px;
    margin-top: 10px;
    display: inline-block;
  }
  button {
    background: #007bff;
    color: white;
    border: none;
    cursor: pointer;
  }
  button:hover {
    background: #0056b3;
  }
</style>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBLYDpP68NlfYGE1O9DafgrmFBUlgpoYeI",
  authDomain: "x-cargo-exprees.firebaseapp.com",
  databaseURL: "https://x-cargo-exprees-default-rtdb.firebaseio.com",
  projectId: "x-cargo-exprees",
  storageBucket: "x-cargo-exprees.appspot.com",
  messagingSenderId: "1082201867958",
  appId: "1:1082201867958:web:d6600fbc82085b0b62c817",
  measurementId: "G-C3Y4PQC86V"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// All fields including checkboxes and customization fields
const fields = [
  "trackingId","sender","senderAddress","receiver","email","phone","address","status","location",
  "shipmentDate","updateDate","expectedDate","weight","description","quantity","remark","image",
  "scheduleDelivery","isSuspended","suspendedDescription","feeWarning","suspendedNotice",
  "suspendedColor","themeColor","backgroundType","backgroundValue","brandingName","brandingUrl",
  "brandingTextColor","fontFamily","fontSize","projectName","leapUrl"
];

// Update preview function
function updatePreview(){
  const preview = document.getElementById("preview");
  let html = '';
  const isSuspended = document.getElementById("isSuspended").checked;

  fields.forEach(f => {
    const el = document.getElementById(f);
    if(!el) return;
    let value = el.type === "checkbox" ? el.checked : el.value.trim();

    // Exclude styling and background fields from live preview
    if(["isSuspended","suspendedColor","themeColor","backgroundType","brandingTextColor","fontFamily","feeWarning","suspendedNotice"].includes(f)) return;

    if(value){
      if(f==="image") html += `<img src="${value}" />`;
      else html += `<p><strong>${f}:</strong> ${value}</p>`;
    }
  });

  // Show suspended message only if checked
  if(isSuspended){
    const color = document.getElementById("suspendedColor").value || "#ff0000";
    const desc = document.getElementById("suspendedDescription").value || "Suspended Package";
    html += `<p class="suspended" style="color:${color}">${desc}</p>`;
  }

  preview.innerHTML = html;
}

// Create package function
window.createPackage = async function(){
  const data = {};
  fields.forEach(f => {
    const el = document.getElementById(f);
    if(!el) return;
    if(el.type === "checkbox") data[f] = el.checked;
    else data[f] = el.value;
  });

  if(!data.trackingId || !data.receiver){
    alert("Tracking ID and Receiver name are required");
    return;
  }

  await set(ref(db, 'packages/' + data.trackingId), data);
  alert("Package created successfully!");
  document.getElementById("packageForm").reset();
  updatePreview();
}

// Attach live preview listeners
fields.forEach(f=>{
  const el = document.getElementById(f);
  if(el){
    el.addEventListener("input", updatePreview);
    if(el.type==="checkbox") el.addEventListener("change", updatePreview);
  }
});
document.getElementById("suspendedColor")?.addEventListener("input", updatePreview);
document.getElementById("suspendedDescription")?.addEventListener("input", updatePreview);

</script>
</head>
<body>
<h2>Create New Package</h2>
<form id="packageForm" onsubmit="event.preventDefault(); createPackage();">

<h3>üì¶ Package Details</h3>
<label>Tracking ID</label>
<input type="text" id="trackingId" placeholder="e.g. XCE001122" required />
<label>Sender Name</label>
<input type="text" id="sender" placeholder="e.g. X-Cargo Logistics" />
<label>Sender Address</label>
<input type="text" id="senderAddress" placeholder="e.g. 123 Warehouse Rd, Accra" />
<label>Receiver Name</label>
<input type="text" id="receiver" placeholder="e.g. John Doe" required />
<label>Receiver Email</label>
<input type="email" id="email" placeholder="e.g. example@email.com" />
<label>Phone Number</label>
<input type="text" id="phone" placeholder="e.g. +233 123 456 7890" />
<label>Delivery Address</label>
<input type="text" id="address" placeholder="e.g. 456 Main St, Kumasi" />
<label>Status</label>
<input type="text" id="status" placeholder="e.g. In Transit" />
<label>Current Location</label>
<input type="text" id="location" placeholder="e.g. Tema Port" />
<label>Shipment Date</label>
<input type="date" id="shipmentDate" />
<label>Update Date</label>
<input type="date" id="updateDate" />
<label>Expected Delivery Date</label>
<input type="date" id="expectedDate" />
<label>Package Weight</label>
<input type="text" id="weight" placeholder="e.g. 12kg" />
<label>Description</label>
<input type="text" id="description" placeholder="e.g. Electronics - Phones" />
<label>Quantity</label>
<input type="number" id="quantity" placeholder="e.g. 3" />
<label>Remarks</label>
<textarea id="remark" placeholder="e.g. Handle with care"></textarea>
<label>Image URL</label>
<input type="text" id="image" placeholder="e.g. https://example.com/image.jpg" />
<label>Schedule Delivery Note</label>
<input type="text" id="scheduleDelivery" placeholder="e.g. Deliver before 5 PM" />

<div class="checkbox-group">
  <input type="checkbox" id="isSuspended" />
  <label for="isSuspended">Suspend this Package</label>
</div>

<label>Suspending Description</label>
<input type="text" id="suspendedDescription" placeholder="Type what appears when suspended" />

<div class="checkbox-group">
  <input type="checkbox" id="feeWarning" />
  <label for="feeWarning">Show ‚ÄúA delivery fee may apply‚Äù</label>
</div>
<div class="checkbox-group">
  <input type="checkbox" id="suspendedNotice" />
  <label for="suspendedNotice">Mark "DELIVERY OF THE SUSPENDED PACKAGE!"</label>
</div>
<label>SUSPENDED Text Color</label>
<input type="color" id="suspendedColor" />

<h3>üñåÔ∏è Customization</h3>
<label>üé® Theme Custom Color</label>
<input type="color" id="themeColor" />
<label>üñºÔ∏è Background Type</label>
<select id="backgroundType">
  <option value="simple">Simple Gradient</option>
  <option value="abstract">Abstract Gradient</option>
  <option value="customGradient">Custom Gradient</option>
  <option value="color">Custom Color</option>
  <option value="image">Image</option>
  <option value="video">Video</option>
</select>
<label>Background Value</label>
<input type="text" id="backgroundValue" placeholder="e.g. #ffffff or https://..." />

<h3>üè∑Ô∏è Branding</h3>
<label>Branding Name</label>
<input type="text" id="brandingName" placeholder="e.g. X-Cargo Express" />
<label>Branding URL</label>
<input type="url" id="brandingUrl" placeholder="e.g. https://x-cargo.com" />
<label>üñåÔ∏è Text Color</label>
<input type="color" id="brandingTextColor" />

<h3>üî§ Fonts</h3>
<label>‚úíÔ∏è Font</label>
<select id="fontFamily">
  <option value="Arial">Arial</option>
  <option value="Verdana">Verdana</option>
  <option value="Times New Roman">Times New Roman</option>
  <option value="Courier New">Courier New</option>
  <option value="Georgia">Georgia</option>
</select>
<label>Font Size (px)</label>
<input type="number" id="fontSize" placeholder="e.g. 16" />

<h3>üßë‚Äç‚úàÔ∏è Advanced</h3>
<label>‚öíÔ∏è Project Name</label>
<input type="text" id="projectName" placeholder="e.g. X-Logistics Monitor" />
<label>‚è© Leap Link URL</label>
<input type="url" id="leapUrl" placeholder="e.g. https://your-site.com/track" />

<button type="submit">CREATE SHIPMENT</button>
</form>

<h3>Live Preview</h3>
<div id="preview"></div>

</body>
    </html>