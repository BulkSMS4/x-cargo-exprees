<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>üöö X-Cargo Express - Update Package Status</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {font-family:"Segoe UI",sans-serif;background:#f5f7fb;color:#333;padding:25px;}
h2{text-align:center;margin-bottom:25px;color:#007bff;}
form{max-width:650px;margin:auto;background:#fff;padding:25px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.1);}
label{display:block;margin-top:10px;font-weight:500;}
input,select,textarea{width:100%;padding:10px;border:1px solid #ccc;border-radius:6px;margin-top:5px;font-size:15px;}
button{background:#007bff;color:#fff;border:none;padding:12px;border-radius:6px;width:100%;margin-top:20px;font-size:16px;cursor:pointer;transition:0.3s;}
button:hover{background:#0056b3;}
.receipt{display:none;background:#fff;padding:25px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.1);max-width:700px;margin:30px auto;position:relative;}
.header{text-align:center;border-bottom:2px solid #007bff;padding-bottom:10px;margin-bottom:15px;}
.header img{width:80px;height:auto;display:block;margin:0 auto 8px;}
.header h2{margin:5px 0;}
.header p{margin:0;font-size:13px;color:#666;}
table{width:100%;border-collapse:collapse;margin-top:15px;}
table td,table th{padding:8px;border:1px solid #ccc;font-size:14px;}
table th{background:#f1f1f1;text-align:left;}
.status-box{text-align:center;margin-top:10px;}
.status-badge{display:inline-block;padding:6px 14px;border-radius:20px;color:#fff;font-weight:bold;}
.warning-box{text-align:center;font-weight:bold;margin-top:10px;}
.pay-button{display:block;background:#28a745;color:#fff;padding:10px 15px;border:none;border-radius:6px;text-align:center;margin:10px auto;cursor:pointer;text-decoration:none;}
.images{text-align:center;margin-top:15px;}
.images img{max-width:220px;margin:8px;border-radius:6px;}
.actions{text-align:center;margin-top:15px;}
.actions button{width:auto;margin:5px;padding:10px 15px;border-radius:6px;}
.actions .pdf{background:#ffc107;}
.actions .print{background:#17a2b8;}
.actions .img{background:#28a745;}
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>

<h2>üöö Update Package Status</h2>

<form id="statusForm">
<label>Enter Tracking ID</label>
<input type="text" id="trackingId" placeholder="e.g. XCE123456" required>

<button type="button" id="fetchBtn">üîç Search Package</button>

<label>Change Status</label>
<select id="status">
<option>Pending</option>
<option>Processing</option>
<option>In Transit</option>
<option>On Hold</option>
<option>Suspended</option>
<option>Delivered</option>
<option>Not Delivered Yet</option>
</select>

<label>Custom Status Color</label>
<input type="color" id="statusColor" value="#007bff">

<h3>‚ö†Ô∏è Warning Settings</h3>
<label><input type="checkbox" id="showWarning"> Show Warning Message</label>
<textarea id="warningText" placeholder="‚ö†Ô∏è Failure to verify may result in account lock!"></textarea>
<label>Warning Text Color</label>
<input type="color" id="warningColor" value="#ff0000">

<h3>üí∞ Payment Option</h3>
<label><input type="checkbox" id="addPay"> Add Pay Button</label>
<input type="text" id="payURL" placeholder="Enter payment URL" disabled>
<label>Payment Button Text</label>
<input type="text" id="payText" placeholder="e.g. Pay Now" disabled>
<label>Payment Button Color</label>
<input type="color" id="payColor" value="#28a745" disabled>

<button type="submit" id="updateBtn" disabled>‚úÖ Update Status</button>
</form>

<div id="receipt" class="receipt">
<div class="header">
<img id="headerLogo" src="" alt="Company Logo">
<h2>X-Cargo Express</h2>
<p>123 Express Avenue, Florida, USA</p>
<p>Email: support@xcargoexpress.com | Tel: +1-800-555-XCEX</p>
</div>

<div class="status-box" id="statusBox"></div>

<table>
<tr><th>Tracking ID</th><td id="rTracking"></td></tr>
<tr><th>Sender</th><td id="rSender"></td></tr>
<tr><th>Receiver</th><td id="rReceiver"></td></tr>
<tr><th>Address</th><td id="rAddress"></td></tr>
<tr><th>Shipment Date</th><td id="rShip"></td></tr>
<tr><th>Expected Delivery</th><td id="rExpected"></td></tr>
<tr><th>Weight</th><td id="rWeight"></td></tr>
<tr><th>Quantity</th><td id="rQuantity"></td></tr>
<tr><th>Description</th><td id="rDesc"></td></tr>
</table>

<div id="warningBox"></div>
<div id="payBox" style="text-align:center;"></div>
<div class="images" id="imageSection"></div>

<div class="actions">
<button class="print" onclick="window.print()">üñ® Print</button>
<button class="pdf" id="downloadPDF">‚¨á PDF</button>
<button class="img" id="saveImage">üñº Save Image</button>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
import { getDatabase, ref, get, child, update } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-database.js";

const firebaseConfig = {
apiKey: "AIzaSyBLYDpP68NlfYGE1O9DafgrmFBUlgpoYeI",
authDomain: "x-cargo-exprees.firebaseapp.com",
databaseURL: "https://x-cargo-exprees-default-rtdb.firebaseio.com",
projectId: "x-cargo-exprees",
storageBucket: "x-cargo-exprees.appspot.com",
messagingSenderId: "1082201867958",
appId: "1:1082201867958:web:d6600fbc82085b0b62c817"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const fetchBtn=document.getElementById("fetchBtn");
const updateBtn=document.getElementById("updateBtn");

// Enable/Disable payment fields
document.getElementById("addPay").addEventListener("change",(e)=>{
  const enable = e.target.checked;
  document.getElementById("payURL").disabled=!enable;
  document.getElementById("payText").disabled=!enable;
  document.getElementById("payColor").disabled=!enable;
});

// Fetch package info
fetchBtn.addEventListener("click", async ()=>{
  const trackingId = document.getElementById("trackingId").value.trim();
  if(!trackingId){alert("Enter Tracking ID"); return;}
  const dbRef = ref(db);
  const snapshot = await get(child(dbRef,"packages/"+trackingId));
  if(!snapshot.exists()){alert("‚ùå Package not found"); return;}
  const data = snapshot.val();
  updateBtn.disabled=false;
  document.getElementById("receipt").style.display="block";

  document.getElementById("rTracking").textContent=data.trackingId||"";
  document.getElementById("rSender").textContent=data.sender||"";
  document.getElementById("rReceiver").textContent=data.receiver||"";
  document.getElementById("rAddress").textContent=data.address||"";
  document.getElementById("rShip").textContent=data.shipmentDate||"";
  document.getElementById("rExpected").textContent=data.expectedDelivery||"";
  document.getElementById("rWeight").textContent=data.weight||"";
  document.getElementById("rQuantity").textContent=data.quantity||"";
  document.getElementById("rDesc").textContent=data.description||"";

  // Status box
  const statusBox=document.getElementById("statusBox");
  statusBox.textContent=document.getElementById("status").value;
  statusBox.style.backgroundColor=document.getElementById("statusColor").value;
  statusBox.className="status-badge";

  // Warning
  const warningBox=document.getElementById("warningBox");
  if(document.getElementById("showWarning").checked){
    warningBox.textContent=document.getElementById("warningText").value;
    warningBox.style.color=document.getElementById("warningColor").value;
    warningBox.className="warning-box";
  } else {
    warningBox.textContent="";
  }

  // Payment Button
  const payBox=document.getElementById("payBox");
  if(document.getElementById("addPay").checked){
    payBox.innerHTML=`<a href="${document.getElementById("payURL").value}" class="pay-button" style="background-color:${document.getElementById("payColor").value}">${document.getElementById("payText").value}</a>`;
  } else {
    payBox.innerHTML="";
  }
});

// Update status in Firebase
updateBtn.addEventListener("click", async (e)=>{
  e.preventDefault();
  const trackingId=document.getElementById("trackingId").value.trim();
  if(!trackingId){alert("Enter Tracking ID"); return;}
  const updates={
    status: document.getElementById("status").value,
    updatedAt: new Date().toISOString()
  };
  await update(ref(db,"packages/"+trackingId), updates);
  alert("‚úÖ Status updated successfully!");
});

// PDF and Image download
document.getElementById("downloadPDF").addEventListener("click",()=>{
  html2canvas(document.getElementById("receipt")).then(canvas=>{
    const imgData=canvas.toDataURL("image/png");
    const pdf=new jspdf.jsPDF();
    const imgProps=pdf.getImageProperties(imgData);
    const pdfWidth=pdf.internal.pageSize.getWidth();
    const pdfHeight=(imgProps.height*pdfWidth)/imgProps.width;
    pdf.addImage(imgData,"PNG",0,0,pdfWidth,pdfHeight);
    pdf.save("X-Cargo-Receipt.pdf");
  });
});
document.getElementById("saveImage").addEventListener("click",()=>{
  html2canvas(document.getElementById("receipt")).then(canvas=>{
    const link=document.createElement("a");
    link.href=canvas.toDataURL("image/png");
    link.download="X-Cargo-Receipt.png";
    link.click();
  });
});
</script>

</body>
</html>
